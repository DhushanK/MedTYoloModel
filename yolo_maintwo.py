Dhushan Kiri
detective_doo
Online

Brandon ‚Äî 2025-01-07, 8:35‚ÄØPM
Reference ‚Å†team-audrey-mechanical for your meeting tomorrow
areeds ‚Äî 2025-01-07, 8:35‚ÄØPM
we‚Äôre hoping you can help us decide between armband and cane in terms of what will be easier for the sensors!
Dhushan Kiri ‚Äî 2025-01-15, 8:24‚ÄØPM
https://docs.google.com/document/d/1ySOgO0A8WZQ-aRqLfWyhPz8hAEOaowO5JX_CQf3wavQ/edit?usp=sharing
Google Docs
MedT Electrical Team: Brainstorming
GPS connection GPS sensor and cross-check current coordinates with preloaded coordinates from Google maps Computer vision OpenCV to analyze visual data Camera data collection Camera sensor (flexible raspberry pi expansion board) for physical connection Small microprocessor with add-on camera s...
Image
Cici ‚Äî 2025-01-17, 7:54‚ÄØPM
hey can you guys let me and yojith know when you're planning to meet? we'd like to join to discuss how to provide output that's useful for elec and what kind of output we're doing
Dhushan Kiri ‚Äî 2025-01-20, 12:48‚ÄØAM
are you guys available from 6-7 tmmr 
sorry for the late reponse we just got it figured out
Yojith ‚Äî 2025-01-20, 3:32‚ÄØPM
today would be tough for me because 1p10 lab may overlap
Dhushan Kiri ‚Äî 2025-01-20, 3:32‚ÄØPM
Ok yea that‚Äôs fine
Let us know when ur available this week
And we can schedule
Dhushan Kiri ‚Äî 2025-01-26, 2:02‚ÄØPM
https://docs.google.com/document/d/1-GKPdBovNa7B8XDm3enk7lLlLpiBf4VbKAen9aRnDVo/edit?usp=sharing
Google Docs
MedT - Parts List
MedT - Elec Part Link Additional info Price Camera 160 degree camera (comes with 2) $24.99 Microcontroller with wifi and bluetooth for camera ESP32-WROVER E/IE Schematic and device manual $23.95 GPS Sensor GPS+BDS Dual‚ÄëMode Module (ATGM336H Replacement for Arduino NEO‚ÄëM8...
Image
Yojith ‚Äî 2025-02-07, 7:47‚ÄØPM
Hey electrical, me and Cici came up with flowchart for the general procedure of the entire algorithm, could you guys take a look and let us know what you think, just to make sure we're all on the same page? If you have any questions please let us know üôè .
Image
Dhushan Kiri ‚Äî 2025-02-09, 5:36‚ÄØPM
Yup i think that matches what i was thinking as well
It‚Äôs really well done !
Brandon ‚Äî 2025-02-11, 8:29‚ÄØPM
not the flow chart ptsd'
Yojith ‚Äî 2025-02-11, 8:35‚ÄØPM
That one lab in 1p10 was something else fs
Sonia P ‚Äî 2025-02-26, 9:08‚ÄØPM
Image
Image
Image
Sonia P ‚Äî 2025-02-26, 9:21‚ÄØPM
https://www.amazon.ca/Resonance-Speaker-Conduction-Vibration-Louderspeaker/dp/B0CZ7HJBVW/ref=sr_1_4?crid=XF2H2UITE0MJ&dib=eyJ2IjoiMSJ9.ddtgquk2yACkBcFWr_FkUqbGxNJIaawWr-KCWQjpEKDtnWmpV_zEH09rp0wpASguhH57bIlV16rrsgi13Ln0VvWfHFUfeIV1hvRg9MhfBf-CGb2piCBkGF68XbKF6g6DE5rdVREvzP8j_sb-PKsHLbf_UNu1tFoykaoz0B4E8ejaT-bb2Hba21Sx66th0NFsopez8L8LeD3sNhiTrruyflw2dfylywlLLvir-SHqCd1c522WiqK_2UQ23m8XRYJeMO5dhY_YuMGZR3uL9gXWSEAvaIOngx-viNHrh8sNQT3j4_060nHmUDmmT70yM9x2z4EvHtn-gu9WAYrSxKmjZ1detMon_IksXVtsZA93kxU6JkWJ2dsQAd_9MWRgQNICCjRhT2dla5XwS36bCXRqMRpdh1sva1uiNoLfSZuL0-aH7eEooE4c_4KY0ymcY8ex.idjEDP5d7leYIW8mtR2--P9wtTgIr1fBkF4G0nPRiq4&dib_tag=se&keywords=bone%2Bconduction%2Btransducer&qid=1740618656&sprefix=bone%2Bconducting%2Btramsducer%2Caps%2C101&sr=8-4&th=1
Resonance Speaker Bone Conduction Vibration Speaker Vibration Stron...
1. Pretty Sounds: The single directional resonance speaker with low harmonic distortion and 85dB to noise ratio has high sound quality.
2. Flexible Using: Widely applied to sound playback and amplification on computers, laptops, MP3, MP4, CDs, mobile phones and other devices.
3. Full Frequency: F...
Image
Christina ‚Äî 2025-03-21, 7:50‚ÄØPM
https://datasheets.raspberrypi.com/camera/picamera2-manual.pdf
Yojith ‚Äî 2025-03-25, 10:17‚ÄØAM
Hey electrical team, what‚Äôs a good time and place for us to meet up today
Christina ‚Äî 2025-03-25, 11:16‚ÄØAM
How about 7?
yasmine ‚Äî 2025-03-25, 11:23‚ÄØAM
that works for me!
Sonia P ‚Äî 2025-03-25, 11:48‚ÄØAM
7 works! 
Sonia P ‚Äî 2025-03-25, 12:26‚ÄØPM
we can meet at my house if everyone is okay with that (since that's where my pi works)
Yojith ‚Äî 2025-03-25, 12:58‚ÄØPM
7 works, could you lmk where your house is
Sonia P ‚Äî 2025-03-25, 1:35‚ÄØPM
97 south oval
areeds ‚Äî 2025-03-25, 1:35‚ÄØPM
omg what i know that place
super cool house, full of super cool people
Dhushan Kiri ‚Äî 2025-03-25, 2:38‚ÄØPM
sounds g
Cici ‚Äî 2025-03-28, 8:06‚ÄØPM
when and where are we meeting tmr? i may have some plans in the evening so earlier in the afternoon would be nice
Dhushan Kiri ‚Äî 2025-03-29, 1:37‚ÄØAM
im good with anytime u guys want
Yojith ‚Äî 2025-03-29, 1:55‚ÄØAM
I‚Äôm fine basically any time after 12
Cici ‚Äî 2025-03-29, 3:06‚ÄØAM
does 2:30 at thode work?
Dhushan Kiri ‚Äî 2025-03-29, 4:10‚ÄØAM
sounds g
Yojith ‚Äî 2025-03-29, 10:12‚ÄØAM
Sounds good
Yojith ‚Äî 2025-03-29, 2:33‚ÄØPM
I‚Äôm just on one of the king tables near the cafe
Audrey ‚Äî 2025-04-01, 9:20‚ÄØPM
@Dhushan Kiri is the cooling component necessary?
Dhushan Kiri ‚Äî 2025-04-01, 9:33‚ÄØPM
Nope
We can easily take it off or use Yasmine‚Äôs pi
Audrey ‚Äî 2025-04-01, 9:33‚ÄØPM
sounds good, let‚Äôs take it off completely then
@Brandon your part won‚Äôt need an extra covering then
Yojith ‚Äî Yesterday at 10:21‚ÄØPM
import math, time, threading
from Headphones import play_sound


class Vehicle:
    width = 1280
Expand
Vehicle_Class.py
5 KB
import time, threading
from ultralytics import YOLO
import cv2
from Vehicle_Class import Vehicle
from Headphones import play_sound  # new
from gpiozero import DistanceSensor
Expand
yolo_main.py
8 KB
@Dhushan Kiri
Ôªø
import time, threading
from ultralytics import YOLO
import cv2
from Vehicle_Class import Vehicle
from Headphones import play_sound  # new
from gpiozero import DistanceSensor
from gpiozero.pins.pigpio import PiGPIOFactory

# Use pigpio for better ultrasonic accuracy
factory = PiGPIOFactory()

# YOLO Setup
model = YOLO("yolo11n.pt")
names = model.names

# Camera Setup
from picamera2 import Picamera2

picam2 = Picamera2()
picam2.configure(
    picam2.create_preview_configuration(main={"format": "RGB888", "size": (1280, 720)})
)
picam2.start()
width = 1280
height = 720

# Ultrasonic Sensors
sensorA = DistanceSensor(echo=17, trigger=27, max_distance=5, pin_factory=factory)
sensorB = DistanceSensor(echo=22, trigger=23, max_distance=5, pin_factory=factory)
sensorC = DistanceSensor(echo=24, trigger=25, max_distance=5, pin_factory=factory)

# Sensor Settings
DETECTION_THRESHOLD = 50  # cm
DISTANCE_TOLERANCE = 5  # cm


def get_distance(sensor):
    try:
        if not sensor.distance_available:
            print("[DISTANCE WARNING] No echo ‚Äî skipping.")
            return 999

        distance = round(sensor.distance * 100, 2)
        if distance == 0:
            print("[DISTANCE WARNING] Invalid reading (0).")
            return 999
        return distance
    except Exception as e:
        print(f"[ULTRASONIC ERROR] {e}")
        return 999


def is_same_object(d1, d2):
    return abs(d1 - d2) <= DISTANCE_TOLERANCE


def get_ultrasonic_zone():
    d1 = get_distance(sensorA)
    time.sleep(0.001)
    d2 = get_distance(sensorB)
    time.sleep(0.001)
    d3 = get_distance(sensorC)

    obj1 = d1 < DETECTION_THRESHOLD
    obj2 = d2 < DETECTION_THRESHOLD
    obj3 = d3 < DETECTION_THRESHOLD

    if obj1 and obj2 and obj3 and is_same_object(d1, d2) and is_same_object(d2, d3):
        return "center_overlap", round((d1 + d2 + d3) / 3, 2)
    elif obj1 and obj2 and is_same_object(d1, d2):
        return "between_left_middle", round((d1 + d2) / 2, 2)
    elif obj2 and obj3 and is_same_object(d2, d3):
        return "between_middle_right", round((d2 + d3) / 2, 2)
    elif obj1 and obj3 and is_same_object(d1, d3):
        return "upper_left_overlap", round((d1 + d3) / 2, 2)
    elif obj1:
        return "left_only", d1
    elif obj2:
        return "middle_only", d2
    elif obj3:
        return "right_only", d3
    else:
        return "none", 999


def get_vehicle(box):
    vehicle_list = ["car", "motorcycle", "bicycle", "bus", "truck", "person"]
    classname = names[int(box.cls)]

    if classname in vehicle_list:
        x1, y1, x2, y2 = map(int, box.xyxy[0])
        if box.id is None:
            return None
        v_id = int(box.id)
        centre = ((x1 + x2) / 2, (y1 + y2) / 2)
        position = (x2, centre[1]) if centre[0] < width / 2 else (x1, centre[1])
        return Vehicle(v_id, position, (x2 - x1) * (y2 - y1), centre, classname)
    return None


# new----------------
def safe_warning():
    # do warning stuff
    threading.Thread(
        target=play_sound, args=(False, "safe_sound.mp3"), daemon=True
    ).start()
    time.sleep(10)
    # lat, lon = 0, 0
    # if get_distance(lat, lon) > 40:
    #     pass


# new----------------


def main():
    last_zone_name = "none"
    last_distance = 999
    last_ultra_time = time.time()
    ultra_interval = 0.5  # 500ms

    while True:
        print(f"[FRAME] Processing frame at {round(time.time(), 2)}")

        frame = picam2.capture_array()
        results = model.track(
            frame, persist=True, tracker="bytetrack.yaml", verbose=False, conf=0.1
        )
        annotated_frame = results[0].plot()
        boxes = results[0].boxes

        current_time = time.time()
        if current_time - last_ultra_time >= ultra_interval:
            last_zone_name, last_distance = get_ultrasonic_zone()
            last_ultra_time = current_time
            print(f"[ULTRA] Zone: {last_zone_name} | Distance: {last_distance} cm")

        zone_name = last_zone_name
        distance = last_distance

        pixel_to_ultrasonic_map = {
            "left": [
                "left_only",
                "upper_left_overlap",
                "between_left_middle",
                "center_overlap",
            ],
            "middle": [
                "center_overlap",
                "middle_only",
                "between_left_middle",
                "between_middle_right",
            ],
            "right": ["right_only", "between_middle_right", "center_overlap"],
        }

        # new---------
        safe_time = time.time()
        # new---------

        for box in boxes:
            vehicle = get_vehicle(box)
            if vehicle:
                x = vehicle.centres[-1][0]

                if x < width / 3:
                    pixel_zone = "left"
                elif x < 2 * width / 3:
                    pixel_zone = "middle"
                else:
                    pixel_zone = "right"

                x1, y1, x2, y2 = map(int, box.xyxy[0])

                print(
                    f"[YOLO] Detected {vehicle.classname.upper()} ID:{vehicle.v_id} in pixel zone: {pixel_zone}"
                )
                print(f"[DEBUG] YOLO zone: {pixel_zone} | Ultrasonic zone: {zone_name}")

                label = f"{vehicle.classname.upper()}"

                if zone_name in pixel_to_ultrasonic_map[pixel_zone]:
                    print(
                        f"[‚úì] MATCH ‚Äî {vehicle.classname.upper()} in {pixel_zone} ‚Äî {distance} cm"
                    )
                    label += f" | Distance: {distance} cm"
                else:
                    print(
                        f"[NO MATCH] ‚Äî {vehicle.classname.upper()} in {pixel_zone} | Sensor zone: {zone_name} | Distance: {distance} cm"
                    )

                # Draw bounding box and label on annotated frame
                cv2.rectangle(annotated_frame, (x1, y1), (x2, y2), (0, 255, 0), 2)
                cv2.putText(
                    annotated_frame,
                    label,
                    (x1, y1 - 10),
                    cv2.FONT_HERSHEY_SIMPLEX,
                    0.6,
                    (0, 255, 0),
                    2,
                )

                # new----------------
                vehicle.append_distance(distance)
                safe_check, warning_message = vehicle.get_warning()

                if not safe_check:
                    safe_time = time.time()
                    Vehicle.play_distance_sound(distance)
                    print(warning_message)

            if time.time() - safe_time >= 5:
                safe_warning()
                safe_time = time.time()
            # new------------

        cv2.imshow("YOLO11 Tracking", annotated_frame)
        if cv2.waitKey(1) & 0xFF == ord("q"):
            break


if __name__ == "__main__":
    main()
yolo_main.py
8 KB
